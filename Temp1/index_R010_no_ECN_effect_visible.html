<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eagle Eye â€” Assembly Tree</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <div class="app-layout">
    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div style="display:flex;align-items:center;gap:8px;">
          <div class="status-dot" id="statusDot"></div>
          <span style="font-size:16px;font-weight:800;color:#e2e8f0;">Eagle Eye</span>
          <span class="tag-badge" id="assyTag">â€¦</span>
        </div>
        <div class="stats" id="statsText">Loadingâ€¦</div>
      </div>

      <!-- TABS -->
      <div class="tab-bar">
        <button class="tab active" data-view="list">ğŸ“‹ List</button>
        <button class="tab" data-view="graph">ğŸ”— Graph</button>
        <button class="tab" data-view="kanban">ğŸ“Š Kanban</button>
      </div>

      <!-- SEARCH -->
      <div style="padding:0 12px 8px;">
        <input class="search-box" type="text" id="searchInput" placeholder="Search P/N, part name, step...">
      </div>

      <!-- ECN -->
      <div style="padding:0 12px 8px;">
        <button class="ecn-toggle" id="ecnToggle">ECN</button>
        <div class="ecn-brushes" id="ecnBrushes" style="display:none;">
          <button class="ecn-brush-btn active" data-brush="remove" style="--c:#ef4444;">Remove</button>
          <button class="ecn-brush-btn" data-brush="replace" style="--c:#f59e0b;">Replace</button>
          <button class="ecn-brush-btn" data-brush="add" style="--c:#10b981;">Add</button>
          <button class="ecn-brush-btn" data-brush="modify" style="--c:#3b82f6;">Modify</button>
          <button class="ecn-brush-btn" id="ecnClear" style="--c:#64748b;">Clear</button>
        </div>
        <div class="ecn-summary" id="ecnSummary" style="display:none;"></div>
      </div>

      <!-- LIST VIEW (in sidebar) -->
      <div class="sidebar-scroll" id="listView"></div>

      <!-- DETAIL PANEL for Graph/Kanban (in sidebar) -->
      <div class="sidebar-scroll" id="sidebarDetail" style="display:none;">
        <div class="empty-detail" id="sidebarEmptyDetail">
          <div style="font-size:40px;">ğŸ”§</div>
          <div>Select a step to view details</div>
          <div style="font-size:10px;margin-top:4px;">Right-click steps for more actions</div>
        </div>
        <div id="sidebarDetailContent"></div>
      </div>
    </div>

    <!-- MAIN AREA -->
    <div class="main-area">
      <!-- GRAPH TOOLBAR -->
      <div class="graph-toolbar" id="graphToolbar" style="display:none;">
        <button class="tool-btn" id="saveBtn">ğŸ’¾ Save</button>
        <button class="tool-btn" id="fitBtn">âŠ¡ Fit</button>
        <button class="tool-btn active" id="seqToggle">1ï¸âƒ£ Seq</button>
        <button class="tool-btn active" id="partsToggle">ğŸ”© Parts</button>
        <button class="tool-btn active" id="headersToggle">ğŸ· Headers</button>
        <button class="tool-btn active" id="fastToggle">ğŸ”— Fasteners</button>
        <button class="tool-btn" id="spacingBtn">â†” Spacing</button>
        <span class="toolbar-status" id="statusText">Connectingâ€¦</span>
      </div>

      <!-- FLOATING LEVEL SPACING PANEL -->
      <div class="spacing-panel" id="spacingPanel" style="display:none;">
        <div class="spacing-panel-header">
          <span>â†” Level Spacing</span>
          <button class="spacing-close" id="spacingClose">Ã—</button>
        </div>
        <div class="spacing-row">
          <span class="spacing-label">Steps â†” Groups</span>
          <input type="range" id="gap1Slider" min="120" max="500" value="300" step="10">
          <input type="number" id="gap1Input" class="spacing-num" value="300" min="120" max="500" step="10">
          <span class="spacing-unit">px</span>
        </div>
        <div class="spacing-row">
          <span class="spacing-label">Groups â†” Root</span>
          <input type="range" id="gap2Slider" min="100" max="400" value="240" step="10">
          <input type="number" id="gap2Input" class="spacing-num" value="240" min="100" max="400" step="10">
          <span class="spacing-unit">px</span>
        </div>
        <div class="spacing-actions">
          <button class="spacing-action-btn" id="spacingReset">â†º Reset</button>
          <button class="spacing-action-btn" id="spacingEqual">= Equal</button>
        </div>
      </div>
      <!-- GROUP FILTER BAR -->
      <div class="group-filter-bar" id="groupFilterBar" style="display:none;">
        <span class="filter-label">Focus:</span>
        <button class="filter-chip active" id="filterAll">All</button>
        <div class="filter-chips" id="filterChips"></div>
        <button class="filter-chip filter-ecn" id="filterEcnOnly" title="Show only groups with ECN changes">âš¡ ECN only</button>
      </div>

      <!-- DETAIL PANEL for List view (right side) -->
      <div class="main-detail" id="mainDetail" style="display:none;">
        <div class="empty-detail" id="mainEmptyDetail">
          <div style="font-size:40px;">ğŸ”§</div>
          <div>Select a step to view details</div>
          <div style="font-size:10px;margin-top:4px;">Right-click steps for more actions</div>
        </div>
        <div id="mainDetailContent"></div>
      </div>

      <!-- GRAPH -->
      <div class="tree-container" id="treeContainer" style="display:none;">
        <svg id="treeSvg"></svg>
        <div class="zoom-controls">
          <button class="zoom-btn" id="zoomInBtn">+</button>
          <button class="zoom-btn" id="zoomOutBtn">âˆ’</button>
          <button class="zoom-btn" id="fitBtn2">âŠ¡</button>
        </div>
        <div class="legend" id="legend"></div>
      </div>

      <!-- KANBAN -->
      <div class="kanban-container" id="kanbanView" style="display:none;"></div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>

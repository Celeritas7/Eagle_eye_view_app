<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eagle Eye ‚Äî Assembly Tree</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{--bg:#0c1222;--bg2:#111827;--bg3:#1e293b;--border:#1e293b;--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;--text4:#475569;--blue:#60a5fa;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--purple:#8b5cf6;--cyan:#06b6d4;--pink:#ec4899;}
body{font-family:'Segoe UI','Noto Sans JP',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;}
button{cursor:pointer;font-family:inherit;border:none;outline:none;}
input,textarea,select{font-family:inherit;outline:none;}
::-webkit-scrollbar{width:6px;height:6px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--bg3);border-radius:3px;}

.app{display:flex;height:100vh;}
.sidebar{width:420px;border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;transition:width .2s;}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}

.hdr{padding:10px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.hdr h1{font-size:14px;font-weight:800;} .hdr h1 span{color:var(--blue);}
.hdr .tag-badge{font-size:9px;padding:2px 8px;border-radius:4px;background:#1e3a5f;color:#93c5fd;font-weight:700;font-family:monospace;}
.hdr .count{font-size:10px;color:var(--text4);margin-left:auto;}
.hdr .status{width:8px;height:8px;border-radius:50%;}

.tabs{padding:6px 14px;border-bottom:1px solid var(--border);display:flex;gap:3px;}
.tab{font-size:10px;padding:4px 12px;border-radius:5px;border:1px solid var(--border);background:transparent;color:var(--text4);flex:1;font-weight:400;transition:all .15s;}
.tab.active{border-color:var(--blue);background:#1e3a5f;color:#93c5fd;font-weight:700;}

.search-box{padding:6px 14px;border-bottom:1px solid var(--border);}
.search-box input{width:100%;padding:5px 10px;background:var(--bg3);border:1px solid #334155;border-radius:6px;color:var(--text);font-size:11px;}

.ecn-bar{padding:6px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.ecn-btn{font-size:10px;padding:3px 10px;border-radius:4px;font-weight:800;}
.ecn-brush{font-size:9px;padding:2px 7px;border-radius:4px;font-weight:700;}
.ecn-summary{padding:6px 14px;border-bottom:1px solid var(--border);font-size:10px;color:var(--yellow);background:rgba(69,26,3,0.13);}

.tree{flex:1;overflow-y:auto;}
.group-hdr{display:flex;align-items:center;gap:8px;padding:8px 14px;cursor:pointer;background:var(--bg2);user-select:none;}
.group-hdr .arrow{font-size:9px;color:var(--text4);transition:transform .15s;display:inline-block;}
.group-hdr .arrow.open{transform:rotate(90deg);}
.group-hdr .label{font-size:12px;font-weight:700;flex:1;}
.group-hdr .cnt{font-size:10px;color:var(--text4);}
.group-hdr .ecn-cnt{font-size:9px;font-weight:800;color:var(--yellow);background:#451a03;padding:1px 6px;border-radius:3px;}
.group-hdr .add-step-btn{font-size:9px;padding:2px 7px;border-radius:3px;border:1px solid transparent;background:transparent;color:var(--text4);opacity:0;transition:opacity .15s;}
.group-hdr:hover .add-step-btn{opacity:1;}
.group-hdr .add-step-btn:hover{border-color:var(--green);color:var(--green);}

.step-row{display:flex;align-items:center;gap:8px;padding:5px 10px 5px 24px;cursor:pointer;transition:all .1s;border-left:3px solid transparent;}
.step-row:hover{background:rgba(255,255,255,0.02);}
.step-row.selected{background:#172033;border-left-color:#3b82f6;}
.step-row .sid{font-family:monospace;font-size:11px;color:var(--text4);min-width:22px;}
.step-row .badge{font-size:8px;font-weight:800;padding:2px 5px;border-radius:3px;font-family:monospace;letter-spacing:0.5px;}
.badge-step{background:#064e3b;color:#6ee7b7;}.badge-prep{background:#312e81;color:#a5b4fc;}.badge-kanryo{background:#7f1d1d;color:#fca5a5;}.badge-note{background:#1e3a5f;color:#93c5fd;}
.step-row .slabel{font-size:11px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.step-row .slabel.kanryo{color:var(--yellow);font-weight:800;}
.step-row .step-row-actions{opacity:0;display:flex;gap:1px;transition:opacity .15s;margin-left:2px;}
.step-row:hover .step-row-actions{opacity:1;}
.step-row .step-row-actions button{font-size:8px;padding:1px 4px;border-radius:3px;background:transparent;border:1px solid transparent;color:var(--text4);line-height:1;}
.step-row .step-row-actions button:hover{border-color:var(--text3);color:var(--text2);}
.tag{font-size:8px;padding:1px 4px;border-radius:3px;font-weight:700;}
.tag-p{background:#0c4a6e;color:#38bdf8;}.tag-f{background:#450a0a;color:#f87171;}
.ecn-mark{font-size:10px;font-weight:800;}

.detail{padding:16px;overflow-y:auto;flex:1;}
.detail-hdr{display:flex;align-items:flex-start;gap:10px;margin-bottom:12px;}
.detail-hdr .did{font-size:22px;font-weight:900;color:#334155;font-family:monospace;line-height:1;}
.detail-hdr .dinfo{flex:1;}.detail-hdr .dgrp{font-size:10px;font-weight:600;margin-bottom:2px;}.detail-hdr .dlabel{font-size:15px;font-weight:700;}
.section-title{font-size:10px;font-weight:800;letter-spacing:1px;margin-bottom:4px;display:flex;align-items:center;gap:6px;}

.item-row{display:flex;align-items:center;gap:6px;padding:5px 8px;font-size:11px;position:relative;border-radius:4px;margin-bottom:1px;}
.item-row:hover{background:rgba(255,255,255,0.03);}
.item-row:hover .row-actions{opacity:1;}
.item-row .dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.item-row .mono{font-family:monospace;min-width:150px;font-size:10px;}
.item-row .iqty{font-weight:600;min-width:24px;text-align:right;}
.row-actions{opacity:0;display:flex;gap:2px;transition:opacity .15s;}
.row-actions button{font-size:9px;padding:1px 5px;border-radius:3px;background:transparent;border:1px solid transparent;}
.row-actions .edit-btn{color:var(--blue);}.row-actions .edit-btn:hover{border-color:var(--blue);}
.row-actions .del-btn{color:var(--red);}.row-actions .del-btn:hover{border-color:var(--red);}
.row-actions .up-btn,.row-actions .dn-btn{color:var(--text4);font-size:8px;}.row-actions .up-btn:hover,.row-actions .dn-btn:hover{color:var(--text2);}
.fast-meta{display:flex;gap:14px;padding-left:11px;font-size:10px;margin-top:1px;}
.add-btn{font-size:9px;padding:2px 8px;border-radius:3px;border:1px dashed var(--border);background:transparent;color:var(--text4);cursor:pointer;margin-top:4px;}
.add-btn:hover{border-color:var(--text3);color:var(--text3);}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:100;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:20px;width:460px;max-height:80vh;overflow-y:auto;}
.modal h3{font-size:14px;font-weight:700;margin-bottom:14px;color:var(--blue);}
.form-row{margin-bottom:10px;}.form-row label{display:block;font-size:10px;color:var(--text3);margin-bottom:3px;font-weight:600;letter-spacing:0.5px;}
.form-row input,.form-row select{width:100%;padding:6px 10px;background:var(--bg);border:1px solid #334155;border-radius:6px;color:var(--text);font-size:12px;}
.form-actions{display:flex;gap:8px;margin-top:16px;}
.btn-primary{padding:6px 16px;border-radius:6px;background:var(--blue);color:#fff;font-size:11px;font-weight:700;}
.btn-ghost{padding:6px 16px;border-radius:6px;background:transparent;border:1px solid var(--border);color:var(--text3);font-size:11px;font-weight:600;}

.ctx-menu{position:fixed;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:4px;z-index:200;min-width:180px;box-shadow:0 8px 32px rgba(0,0,0,0.6);}
.ctx-item{padding:6px 12px;font-size:11px;color:var(--text2);border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:8px;}
.ctx-item:hover{background:rgba(255,255,255,0.05);color:var(--text);}
.ctx-item.danger{color:var(--red);}
.ctx-sep{height:1px;background:var(--border);margin:4px 0;}

.kanban{display:flex;gap:8px;padding:12px;flex:1;overflow-x:auto;background:#060c18;}
.kan-col{min-width:190px;max-width:220px;flex-shrink:0;display:flex;flex-direction:column;}
.kan-hdr{padding:8px 10px;border-radius:8px 8px 0 0;margin-bottom:6px;}
.kan-cards{display:flex;flex-direction:column;gap:4px;flex:1;overflow-y:auto;}
.kan-card{padding:8px 10px;background:var(--bg2);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all .15s;position:relative;}
.kan-card:hover{border-color:var(--text3);}.kan-card.selected{border-color:var(--blue);}

.graph-container{flex:1;overflow:hidden;background:#060c18;position:relative;}
.empty{display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;gap:10px;}
.empty .big{font-size:48px;opacity:0.15;}.empty .msg{font-size:13px;color:#334155;text-align:center;line-height:1.8;}
.step-actions{display:flex;gap:4px;margin-top:8px;margin-bottom:12px;flex-wrap:wrap;}
.step-actions button{font-size:9px;padding:3px 10px;border-radius:4px;border:1px solid var(--border);background:transparent;color:var(--text3);font-weight:600;}
.step-actions button:hover{border-color:var(--text2);color:var(--text2);}
.step-actions button.danger:hover{border-color:var(--red);color:var(--red);}
.loading-bar{height:2px;background:linear-gradient(90deg,transparent,var(--blue),transparent);animation:slide 1s infinite;}
@keyframes slide{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.toast{position:fixed;bottom:20px;right:20px;padding:8px 16px;border-radius:6px;font-size:11px;font-weight:600;z-index:300;animation:fadeIn .2s;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useCallback,useRef,createContext,useContext} = React;

// ‚ïê‚ïê‚ïê SUPABASE ‚ïê‚ïê‚ïê
const SUPA_URL='https://ulgrfumbwjovbjzjiems.supabase.co';
const SUPA_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsZ3JmdW1id2pvdmJqemppZW1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNzIyNjcsImV4cCI6MjA4Mjk0ODI2N30.ix5Vh4Y3GXNbQbzVtTD_WSko0L3cr5q_eCnTuDEMh7M';
const sb=supabase.createClient(SUPA_URL,SUPA_KEY);

// Table names
const T={
  assy:'Eagle_eye_app_assemblies',
  grp:'Eagle_eye_app_groups',
  step:'Eagle_eye_app_steps',
  part:'Eagle_eye_app_parts',
  fast:'Eagle_eye_app_fasteners',
  ecn:'Eagle_eye_app_ecn_log'
};

// ‚ïê‚ïê‚ïê DATA CONTEXT ‚ïê‚ïê‚ïê
const DataCtx=createContext({});

function useData(){return useContext(DataCtx);}

function DataProvider({children}){
  const [assy,setAssy]=useState(null);
  const [groups,setGroups]=useState([]);
  const [steps,setSteps]=useState([]);
  const [parts,setParts]=useState([]);
  const [fasts,setFasts]=useState([]);
  const [loading,setLoading]=useState(true);
  const [error,setError]=useState(null);
  const [toast,setToast]=useState(null);

  const showToast=(msg,type='ok')=>{setToast({msg,type});setTimeout(()=>setToast(null),2000);};

  // Load all data for HBD_assy
  const loadAll=useCallback(async()=>{
    try{
      const {data:a}=await sb.from(T.assy).select('*').eq('tag','HBD_assy').single();
      if(!a){setError('Assembly HBD_assy not found. Run the SQL setup first.');setLoading(false);return;}
      setAssy(a);
      const {data:g}=await sb.from(T.grp).select('*').eq('assembly_id',a.id).order('sort_order');
      setGroups(g||[]);
      const gids=(g||[]).map(x=>x.id);
      if(gids.length){
        const {data:s}=await sb.from(T.step).select('*').in('group_id',gids).order('sort_order');
        setSteps(s||[]);
        const sids=(s||[]).map(x=>x.id);
        if(sids.length){
          const {data:p}=await sb.from(T.part).select('*').in('step_id',sids).order('sort_order');
          setParts(p||[]);
          const {data:f}=await sb.from(T.fast).select('*').in('step_id',sids).order('sort_order');
          setFasts(f||[]);
        }
      }
      setLoading(false);
    }catch(e){setError(e.message);setLoading(false);}
  },[]);

  useEffect(()=>{loadAll();},[loadAll]);

  // ‚ïê‚ïê‚ïê CRUD helpers ‚ïê‚ïê‚ïê
  const refresh=async()=>{await loadAll();};

  const addStep=async(groupId,label,type)=>{
    const maxSort=Math.max(0,...steps.filter(s=>s.group_id===groupId).map(s=>s.sort_order||0))+1;
    const {error:e}=await sb.from(T.step).insert({group_id:groupId,label,type,sort_order:maxSort});
    if(e){showToast(e.message,'err');return;}
    showToast('Step added');await refresh();
  };

  const updateStep=async(id,fields)=>{
    const {error:e}=await sb.from(T.step).update(fields).eq('id',id);
    if(e){showToast(e.message,'err');return;}
    showToast('Step updated');await refresh();
  };

  const deleteStep=async(id)=>{
    await sb.from(T.part).delete().eq('step_id',id);
    await sb.from(T.fast).delete().eq('step_id',id);
    const {error:e}=await sb.from(T.step).delete().eq('id',id);
    if(e){showToast(e.message,'err');return;}
    showToast('Step deleted');await refresh();
  };

  const moveStep=async(step,newGroupId)=>{
    const maxSort=Math.max(0,...steps.filter(s=>s.group_id===newGroupId).map(s=>s.sort_order||0))+1;
    await sb.from(T.step).update({group_id:newGroupId,sort_order:maxSort}).eq('id',step.id);
    showToast('Step moved');await refresh();
  };

  const swapSteps=async(step,dir)=>{
    const sibs=steps.filter(s=>s.group_id===step.group_id).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
    const idx=sibs.findIndex(s=>s.id===step.id);
    const si=idx+dir;
    if(si<0||si>=sibs.length)return;
    const a=sibs[idx],b=sibs[si];
    await sb.from(T.step).update({sort_order:b.sort_order}).eq('id',a.id);
    await sb.from(T.step).update({sort_order:a.sort_order}).eq('id',b.id);
    await refresh();
  };

  const addPart=async(stepId,pn,qty)=>{
    const maxSort=Math.max(0,...parts.filter(p=>p.step_id===stepId).map(p=>p.sort_order||0))+1;
    const {error:e}=await sb.from(T.part).insert({step_id:stepId,pn,qty:Number(qty),sort_order:maxSort});
    if(e){showToast(e.message,'err');return;}
    showToast('Part added');await refresh();
  };

  const updatePart=async(id,fields)=>{
    const {error:e}=await sb.from(T.part).update(fields).eq('id',id);
    if(e){showToast(e.message,'err');return;}
    showToast('Part updated');await refresh();
  };

  const deletePart=async(id)=>{
    await sb.from(T.part).delete().eq('id',id);
    showToast('Part deleted');await refresh();
  };

  const swapParts=async(stepId,partId,dir)=>{
    const sibs=parts.filter(p=>p.step_id===stepId).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
    const idx=sibs.findIndex(p=>p.id===partId);const si=idx+dir;
    if(si<0||si>=sibs.length)return;
    await sb.from(T.part).update({sort_order:sibs[si].sort_order}).eq('id',sibs[idx].id);
    await sb.from(T.part).update({sort_order:sibs[idx].sort_order}).eq('id',sibs[si].id);
    await refresh();
  };

  const addFast=async(stepId,pn,qty,loctite,torque)=>{
    const maxSort=Math.max(0,...fasts.filter(f=>f.step_id===stepId).map(f=>f.sort_order||0))+1;
    const {error:e}=await sb.from(T.fast).insert({step_id:stepId,pn,qty:Number(qty),loctite,torque,sort_order:maxSort});
    if(e){showToast(e.message,'err');return;}
    showToast('Fastener added');await refresh();
  };

  const updateFast=async(id,fields)=>{
    const {error:e}=await sb.from(T.fast).update(fields).eq('id',id);
    if(e){showToast(e.message,'err');return;}
    showToast('Fastener updated');await refresh();
  };

  const deleteFast=async(id)=>{
    await sb.from(T.fast).delete().eq('id',id);
    showToast('Fastener deleted');await refresh();
  };

  const swapFasts=async(stepId,fastId,dir)=>{
    const sibs=fasts.filter(f=>f.step_id===stepId).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
    const idx=sibs.findIndex(f=>f.id===fastId);const si=idx+dir;
    if(si<0||si>=sibs.length)return;
    await sb.from(T.fast).update({sort_order:sibs[si].sort_order}).eq('id',sibs[idx].id);
    await sb.from(T.fast).update({sort_order:sibs[idx].sort_order}).eq('id',sibs[si].id);
    await refresh();
  };

  const val={assy,groups,steps,parts,fasts,loading,error,toast,
    addStep,updateStep,deleteStep,moveStep,swapSteps,
    addPart,updatePart,deletePart,swapParts,
    addFast,updateFast,deleteFast,swapFasts,
    refresh};

  return <DataCtx.Provider value={val}>{children}</DataCtx.Provider>;
}

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
const ecnC={remove:'#ef4444',replace:'#f59e0b',add:'#10b981',modify:'#3b82f6'};
const ecnI={remove:'‚úï',replace:'‚Üª',add:'+',modify:'~'};
const ecnBg={remove:'rgba(239,68,68,0.08)',replace:'rgba(245,158,11,0.08)',add:'rgba(16,185,129,0.08)',modify:'rgba(59,130,246,0.08)'};
const bC={step:'badge-step',prep:'badge-prep',kanryo:'badge-kanryo',note:'badge-note'};
const bT={step:'STEP',prep:'PREP',kanryo:'ÂÆå‰∫Ü',note:'NOTE'};

// ‚ïê‚ïê‚ïê CONTEXT MENU ‚ïê‚ïê‚ïê
function CtxMenu({x,y,items,onClose}){
  const ref=useRef(null);
  const [pos,setPos]=useState({x,y});
  useEffect(()=>{const h=e=>{if(ref.current&&!ref.current.contains(e.target))onClose();};document.addEventListener('mousedown',h);return()=>document.removeEventListener('mousedown',h);},[onClose]);
  useEffect(()=>{if(ref.current){const r=ref.current.getBoundingClientRect();setPos({x:Math.max(0,r.right>window.innerWidth?x-r.width:x),y:Math.max(0,r.bottom>window.innerHeight?y-r.height:y)});}},[x,y]);
  return(<div ref={ref} className="ctx-menu" style={{left:pos.x,top:pos.y}}>
    {items.map((it,i)=>it.sep?<div key={i} className="ctx-sep"/>:
      <div key={i} className={'ctx-item'+(it.danger?' danger':'')} onClick={()=>{it.action();onClose();}}>
        <span style={{width:16,textAlign:'center',fontSize:12}}>{it.icon||''}</span>{it.label}
      </div>)}
  </div>);
}

// ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê
function PartModal({mode,stepId,data,onClose}){
  const {addPart,updatePart}=useData();
  const [pn,setPn]=useState(data?.pn||'');const [qty,setQty]=useState(data?.qty||1);
  const save=async()=>{if(!pn)return;if(mode==='add')await addPart(stepId,pn,qty);else await updatePart(data.id,{pn,qty:Number(qty)});onClose();};
  return(<div className="modal-overlay" onClick={onClose}><div className="modal" onClick={e=>e.stopPropagation()}>
    <h3>{mode==='add'?'Add Part':'Edit Part'}</h3>
    <div className="form-row"><label>P/N</label><input value={pn} onChange={e=>setPn(e.target.value)} placeholder="GPCP-0000000-0-0" autoFocus/></div>
    <div className="form-row"><label>Qty</label><input type="number" value={qty} onChange={e=>setQty(e.target.value)} min={1}/></div>
    <div className="form-actions"><button className="btn-primary" onClick={save}>{mode==='add'?'Add':'Save'}</button><button className="btn-ghost" onClick={onClose}>Cancel</button></div>
  </div></div>);
}

function FastModal({mode,stepId,data,onClose}){
  const {addFast,updateFast}=useData();
  const [pn,setPn]=useState(data?.pn||'');const [qty,setQty]=useState(data?.qty||1);const [lt,setLt]=useState(data?.loctite||'222');const [tq,setTq]=useState(data?.torque||'');
  const save=async()=>{if(!pn)return;if(mode==='add')await addFast(stepId,pn,qty,lt,tq);else await updateFast(data.id,{pn,qty:Number(qty),loctite:lt,torque:tq});onClose();};
  return(<div className="modal-overlay" onClick={onClose}><div className="modal" onClick={e=>e.stopPropagation()}>
    <h3>{mode==='add'?'Add Fastener':'Edit Fastener'}</h3>
    <div className="form-row"><label>P/N</label><input value={pn} onChange={e=>setPn(e.target.value)} placeholder="GPCP-0000000-0-0" autoFocus/></div>
    <div className="form-row"><label>Qty</label><input type="number" value={qty} onChange={e=>setQty(e.target.value)} min={1}/></div>
    <div className="form-row"><label>Loctite</label><select value={lt} onChange={e=>setLt(e.target.value)}><option value="222">222</option><option value="243">243</option><option value="425">425</option><option value="648">648</option><option value="---">---</option></select></div>
    <div className="form-row"><label>Torque</label><input value={tq} onChange={e=>setTq(e.target.value)} placeholder="1.14 Nm"/></div>
    <div className="form-actions"><button className="btn-primary" onClick={save}>{mode==='add'?'Add':'Save'}</button><button className="btn-ghost" onClick={onClose}>Cancel</button></div>
  </div></div>);
}

function StepModal({mode,groupId,data,onClose}){
  const {groups,addStep,updateStep,moveStep:mv}=useData();
  const [label,setLabel]=useState(data?.label||'');const [type,setType]=useState(data?.type||'step');const [gid,setGid]=useState(data?.group_id||groupId);
  const save=async()=>{if(!label)return;if(mode==='add')await addStep(gid,label,type);else{await updateStep(data.id,{label,type});if(data.group_id!==gid)await mv(data,gid);}onClose();};
  return(<div className="modal-overlay" onClick={onClose}><div className="modal" onClick={e=>e.stopPropagation()}>
    <h3>{mode==='add'?'Add Step':'Edit Step'}</h3>
    <div className="form-row"><label>Label</label><input value={label} onChange={e=>setLabel(e.target.value)} placeholder="Step name" autoFocus/></div>
    <div className="form-row"><label>Type</label><select value={type} onChange={e=>setType(e.target.value)}><option value="step">Step</option><option value="prep">Prep</option><option value="kanryo">ÂÆå‰∫Ü</option><option value="note">Note</option></select></div>
    <div className="form-row"><label>Group</label><select value={gid} onChange={e=>setGid(Number(e.target.value))}>{groups.map(g=><option key={g.id} value={g.id}>{g.icon} {g.label}</option>)}</select></div>
    <div className="form-actions"><button className="btn-primary" onClick={save}>{mode==='add'?'Add':'Save'}</button><button className="btn-ghost" onClick={onClose}>Cancel</button></div>
  </div></div>);
}

function MoveModal({stepData,onClose}){
  const {groups,moveStep}=useData();
  const [gid,setGid]=useState(stepData.group_id);
  const move=async()=>{if(gid===stepData.group_id){onClose();return;}await moveStep(stepData,gid);onClose();};
  return(<div className="modal-overlay" onClick={onClose}><div className="modal" onClick={e=>e.stopPropagation()}>
    <h3>Move "{stepData.label}"</h3>
    <div className="form-row"><label>Move to group</label><select value={gid} onChange={e=>setGid(Number(e.target.value))}>{groups.map(g=><option key={g.id} value={g.id}>{g.icon} {g.label}</option>)}</select></div>
    <div className="form-actions"><button className="btn-primary" onClick={move}>Move</button><button className="btn-ghost" onClick={onClose}>Cancel</button></div>
  </div></div>);
}

// ‚ïê‚ïê‚ïê DETAIL PANEL ‚ïê‚ïê‚ïê
function DetailPanel({stepId,ecnChanges}){
  const {groups,steps,parts,fasts,deleteStep,swapParts,deletePart,swapFasts,deleteFast}=useData();
  const [modal,setModal]=useState(null);
  if(!stepId)return <div className="empty"><div className="big">üîß</div><div className="msg">Select a step to view details<br/>Right-click steps for more actions</div></div>;
  const s=steps.find(x=>x.id===stepId);
  if(!s)return <div className="empty"><div className="msg">Step not found</div></div>;
  const g=groups.find(x=>x.id===s.group_id);
  const sp=parts.filter(p=>p.step_id===stepId).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
  const sf=fasts.filter(f=>f.step_id===stepId).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
  const ecn=ecnChanges[stepId]||'none';

  return(<div className="detail">
    <div className="detail-hdr">
      <div className="did">{s.id}</div>
      <div className="dinfo">
        <div className="dgrp" style={{color:g?.color}}>‚Ü≥ {g?.label}</div>
        <div className="dlabel" style={{color:s.type==='kanryo'?'var(--yellow)':'var(--text)'}}>{s.label}</div>
      </div>
      {ecn!=='none'&&<span style={{padding:'3px 10px',borderRadius:5,background:ecnC[ecn]+'18',border:'1px solid '+ecnC[ecn],color:ecnC[ecn],fontSize:10,fontWeight:800,textTransform:'uppercase'}}>{ecn}</span>}
    </div>
    <div className="step-actions">
      <button onClick={()=>setModal({t:'editStep',d:s})}>‚úèÔ∏è Edit</button>
      <button onClick={()=>setModal({t:'moveStep',d:s})}>üì¶ Move</button>
      <button className="danger" onClick={()=>{if(confirm(`Delete "${s.label}"?`))deleteStep(s.id);}}>üóë Delete</button>
    </div>

    <div className="section-title" style={{color:'var(--green)'}}>PARTS ({sp.length})<button className="add-btn" onClick={()=>setModal({t:'addP',sid:stepId})}>+ Add</button></div>
    {sp.map((p,i)=><div key={p.id} className="item-row" style={{background:i%2?'#071a12':'transparent'}}>
      <div className="dot" style={{background:'var(--green)'}}/><span className="mono" style={{color:'#34d399'}}>{p.pn}</span><span className="iqty" style={{color:'#6ee7b7'}}>√ó{p.qty}</span>
      <div className="row-actions"><button className="up-btn" onClick={()=>swapParts(stepId,p.id,-1)}>‚ñ≤</button><button className="dn-btn" onClick={()=>swapParts(stepId,p.id,1)}>‚ñº</button><button className="edit-btn" onClick={()=>setModal({t:'editP',sid:stepId,d:p})}>‚úèÔ∏è</button><button className="del-btn" onClick={()=>{if(confirm('Delete?'))deletePart(p.id);}}>‚úï</button></div>
    </div>)}

    <div className="section-title" style={{color:'var(--red)',marginTop:16}}>FASTENERS ({sf.length})<button className="add-btn" onClick={()=>setModal({t:'addF',sid:stepId})}>+ Add</button></div>
    {sf.map((f,i)=><div key={f.id}>
      <div className="item-row" style={{background:i%2?'#1a0505':'transparent'}}>
        <div className="dot" style={{background:'var(--red)'}}/><span className="mono" style={{color:'#fca5a5'}}>{f.pn}</span><span className="iqty" style={{color:'#f87171'}}>√ó{f.qty}</span>
        <div className="row-actions"><button className="up-btn" onClick={()=>swapFasts(stepId,f.id,-1)}>‚ñ≤</button><button className="dn-btn" onClick={()=>swapFasts(stepId,f.id,1)}>‚ñº</button><button className="edit-btn" onClick={()=>setModal({t:'editF',sid:stepId,d:f})}>‚úèÔ∏è</button><button className="del-btn" onClick={()=>{if(confirm('Delete?'))deleteFast(f.id);}}>‚úï</button></div>
      </div>
      <div className="fast-meta"><span><span style={{color:'var(--text4)'}}>LT </span><span style={{color:f.loctite==='---'?'var(--text4)':'var(--yellow)',fontWeight:700}}>{f.loctite}</span></span><span><span style={{color:'var(--text4)'}}>TQ </span><span style={{color:!f.torque||f.torque==='---'?'var(--text4)':'var(--blue)',fontWeight:700}}>{f.torque||'‚Äî'}</span></span></div>
    </div>)}

    {modal?.t==='addP'&&<PartModal mode="add" stepId={modal.sid} onClose={()=>setModal(null)}/>}
    {modal?.t==='editP'&&<PartModal mode="edit" stepId={modal.sid} data={modal.d} onClose={()=>setModal(null)}/>}
    {modal?.t==='addF'&&<FastModal mode="add" stepId={modal.sid} onClose={()=>setModal(null)}/>}
    {modal?.t==='editF'&&<FastModal mode="edit" stepId={modal.sid} data={modal.d} onClose={()=>setModal(null)}/>}
    {modal?.t==='editStep'&&<StepModal mode="edit" data={modal.d} onClose={()=>setModal(null)}/>}
    {modal?.t==='moveStep'&&<MoveModal stepData={modal.d} onClose={()=>setModal(null)}/>}
  </div>);
}

// ‚ïê‚ïê‚ïê LIST VIEW ‚ïê‚ïê‚ïê
function ListView({selected,setSelected,ecnOn,brush,ecnChanges,setEcnChanges,search}){
  const {groups,steps,parts,fasts,swapSteps,deleteStep}=useData();
  const [exp,setExp]=useState(new Set());
  const [ctx,setCtx]=useState(null);
  const [modal,setModal]=useState(null);

  useEffect(()=>{setExp(new Set(groups.map(g=>g.id)));},[groups]);

  const toggle=id=>setExp(p=>{const n=new Set(p);n.has(id)?n.delete(id):n.add(id);return n;});
  const click=id=>{if(ecnOn){setEcnChanges(p=>{const n={...p};n[id]===brush?delete n[id]:(n[id]=brush);return n;});}else setSelected(selected===id?null:id);};

  const searchLower=search?.toLowerCase()||'';
  const matchStep=s=>{
    if(!searchLower)return true;
    if(s.label.toLowerCase().includes(searchLower))return true;
    if(parts.some(p=>p.step_id===s.id&&p.pn.toLowerCase().includes(searchLower)))return true;
    if(fasts.some(f=>f.step_id===s.id&&f.pn.toLowerCase().includes(searchLower)))return true;
    return false;
  };

  return(<div className="tree">
    {groups.map(g=>{
      const gSteps=steps.filter(s=>s.group_id===g.id).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
      const open=exp.has(g.id);const gEcn=gSteps.filter(s=>ecnChanges[s.id]).length;
      return(<div key={g.id}>
        <div className="group-hdr" onClick={()=>toggle(g.id)} style={{borderLeft:'3px solid '+g.color}}>
          <span className={'arrow'+(open?' open':'')}>‚ñ∂</span><span style={{fontSize:12}}>{g.icon}</span><span className="label" style={{color:g.color}}>{g.label}</span>
          <button className="add-step-btn" onClick={e=>{e.stopPropagation();setModal({t:'addStep',gid:g.id});}}>+ step</button>
          <span className="cnt">{gSteps.length}</span>{gEcn>0&&<span className="ecn-cnt">{gEcn}</span>}
        </div>
        {open&&gSteps.map(s=>{
          const e=ecnChanges[s.id];const sel=selected===s.id;const vis=matchStep(s);
          const pc=parts.filter(p=>p.step_id===s.id).length;
          const fc=fasts.filter(f=>f.step_id===s.id).length;
          return(<div key={s.id} className={'step-row'+(sel?' selected':'')} onClick={()=>click(s.id)} onContextMenu={ev=>{ev.preventDefault();setCtx({x:ev.clientX,y:ev.clientY,s});}}
            style={{background:e?ecnBg[e]:undefined,borderLeftColor:e?ecnC[e]:undefined,opacity:vis?1:0.2}}>
            <span className="sid">{s.id}</span><span className={'badge '+(bC[s.type]||'badge-step')}>{bT[s.type]||'STEP'}</span>
            <span className={'slabel'+(s.type==='kanryo'?' kanryo':'')} title={s.label}>{s.label}</span>
            {pc>0&&<span className="tag tag-p">{pc}P</span>}{fc>0&&<span className="tag tag-f">{fc}F</span>}
            {e&&<span className="ecn-mark" style={{color:ecnC[e]}}>{ecnI[e]}</span>}
            <div className="step-row-actions">
              <button onClick={ev=>{ev.stopPropagation();swapSteps(s,-1);}} title="Move up">‚ñ≤</button>
              <button onClick={ev=>{ev.stopPropagation();swapSteps(s,1);}} title="Move down">‚ñº</button>
            </div>
          </div>);
        })}
      </div>);
    })}
    {ctx&&<CtxMenu x={ctx.x} y={ctx.y} onClose={()=>setCtx(null)} items={[
      {icon:'‚úèÔ∏è',label:'Edit step',action:()=>setModal({t:'editStep',d:ctx.s})},
      {icon:'üì¶',label:'Move to group...',action:()=>setModal({t:'moveStep',d:ctx.s})},
      {sep:true},{icon:'‚ñ≤',label:'Move up',action:()=>swapSteps(ctx.s,-1)},{icon:'‚ñº',label:'Move down',action:()=>swapSteps(ctx.s,1)},
      {sep:true},{icon:'üóë',label:'Delete step',action:()=>{if(confirm(`Delete "${ctx.s.label}"?`))deleteStep(ctx.s.id);},danger:true},
    ]}/>}
    {modal?.t==='addStep'&&<StepModal mode="add" groupId={modal.gid} onClose={()=>setModal(null)}/>}
    {modal?.t==='editStep'&&<StepModal mode="edit" data={modal.d} onClose={()=>setModal(null)}/>}
    {modal?.t==='moveStep'&&<MoveModal stepData={modal.d} onClose={()=>setModal(null)}/>}
  </div>);
}

// ‚ïê‚ïê‚ïê GRAPH VIEW ‚ïê‚ïê‚ïê
function GraphView({selected,setSelected,ecnOn,brush,ecnChanges,setEcnChanges}){
  const {groups,steps,parts,fasts}=useData();
  const ref=useRef(null);const [dim,setDim]=useState({w:900,h:700});const [hov,setHov]=useState(null);
  useEffect(()=>{if(ref.current){const r=ref.current.getBoundingClientRect();setDim({w:r.width||900,h:r.height||700});}},[]);

  const sortedSteps=steps.slice().sort((a,b)=>{const ga=groups.findIndex(g=>g.id===a.group_id),gb=groups.findIndex(g=>g.id===b.group_id);return ga!==gb?ga-gb:(a.sort_order||0)-(b.sort_order||0);});
  const pnList=[...new Set(parts.map(p=>p.pn))].sort();
  const fnList=[...new Set(fasts.map(f=>f.pn))].sort();

  const pX=5,sX=dim.w*0.3,fX=dim.w*0.66;
  const pYf=i=>22+i*((dim.h-44)/Math.max(pnList.length-1,1));
  const sYf=i=>22+i*((dim.h-44)/Math.max(sortedSteps.length-1,1));
  const fYf=i=>22+i*((dim.h-44)/Math.max(fnList.length-1,1));

  const active=hov||selected;
  const ap=active?parts.filter(p=>p.step_id===active).map(p=>p.pn):[];
  const af=active?fasts.filter(f=>f.step_id===active).map(f=>f.pn):[];

  const click=id=>{if(ecnOn){setEcnChanges(p=>{const n={...p};n[id]===brush?delete n[id]:(n[id]=brush);return n;});}else setSelected(selected===id?null:id);};

  const gColor=gid=>groups.find(g=>g.id===gid)?.color||'#475569';

  return(<div ref={ref} className="graph-container"><svg width={dim.w} height={dim.h}>
    <text x={pX} y={12} fontSize={9} fill="#334155" fontWeight={700}>PARTS ({pnList.length})</text>
    <text x={sX} y={12} fontSize={9} fill="#334155" fontWeight={700}>STEPS ({sortedSteps.length})</text>
    <text x={fX} y={12} fontSize={9} fill="#334155" fontWeight={700}>FASTENERS ({fnList.length})</text>
    {sortedSteps.map((s,si)=>parts.filter(p=>p.step_id===s.id).map((p,pi)=>{const pi2=pnList.indexOf(p.pn);if(pi2<0)return null;const e=ecnChanges[s.id];const a=active===s.id;return <line key={`ps${si}-${pi}`} x1={pX+105} y1={pYf(pi2)} x2={sX} y2={sYf(si)} stroke={e?ecnC[e]:a?gColor(s.group_id):'#1e293b'} strokeWidth={a?1.5:0.4} opacity={a?0.7:e?0.5:0.15}/>;}))}
    {sortedSteps.map((s,si)=>fasts.filter(f=>f.step_id===s.id).map((f,fi)=>{const fi2=fnList.indexOf(f.pn);if(fi2<0)return null;const e=ecnChanges[s.id];const a=active===s.id;return <line key={`sf${si}-${fi}`} x1={sX+155} y1={sYf(si)} x2={fX} y2={fYf(fi2)} stroke={e?ecnC[e]:a?'#f87171':'#1e293b'} strokeWidth={a?1.5:0.4} opacity={a?0.7:e?0.5:0.15}/>;}))}
    {pnList.map((p,i)=>{const a=ap.includes(p);return <g key={`p${i}`}><rect x={pX} y={pYf(i)-7} width={103} height={14} rx={3} fill={a?'#0c4a6e':'#111827'} stroke={a?'#38bdf8':'#1e293b33'} strokeWidth={a?1:0.5}/><text x={pX+4} y={pYf(i)+3} fontSize={6.5} fill={a?'#7dd3fc':'#475569'} style={{fontFamily:'monospace'}}>{p.slice(0,18)}</text></g>;})}
    {sortedSteps.map((s,i)=>{const e=ecnChanges[s.id];const a=active===s.id;const gc=gColor(s.group_id);return <g key={`s${i}`} onMouseEnter={()=>setHov(s.id)} onMouseLeave={()=>setHov(null)} onClick={()=>click(s.id)} style={{cursor:'pointer'}}><rect x={sX} y={sYf(i)-8} width={153} height={16} rx={4} fill={e?ecnBg[e]:a?gc+'22':'#111827'} stroke={e?ecnC[e]:a?gc:'#1e293b44'} strokeWidth={a||e?1.5:0.5}/><text x={sX+5} y={sYf(i)+3} fontSize={7.5} fill={a?'#f1f5f9':e?ecnC[e]:'#94a3b8'} fontWeight={a?700:400} style={{fontFamily:'system-ui'}}>{s.label.slice(0,24)}</text>{e&&<text x={sX+145} y={sYf(i)+4} fontSize={9} fill={ecnC[e]} fontWeight={900} textAnchor="end">{ecnI[e]}</text>}</g>;})}
    {fnList.map((f,i)=>{const a=af.includes(f);return <g key={`f${i}`}><rect x={fX} y={fYf(i)-7} width={88} height={14} rx={3} fill={a?'#450a0a':'#111827'} stroke={a?'#f87171':'#1e293b33'} strokeWidth={a?1:0.5}/><text x={fX+4} y={fYf(i)+3} fontSize={6.5} fill={a?'#fca5a5':'#475569'} style={{fontFamily:'monospace'}}>{f.slice(0,15)}</text></g>;})}
  </svg></div>);
}

// ‚ïê‚ïê‚ïê KANBAN VIEW ‚ïê‚ïê‚ïê
function KanbanView({selected,setSelected,ecnOn,brush,ecnChanges,setEcnChanges}){
  const {groups,steps,parts,fasts}=useData();
  const click=id=>{if(ecnOn){setEcnChanges(p=>{const n={...p};n[id]===brush?delete n[id]:(n[id]=brush);return n;});}else setSelected(selected===id?null:id);};
  return(<div className="kanban">{groups.map(g=>{
    const gSteps=steps.filter(s=>s.group_id===g.id).sort((a,b)=>(a.sort_order||0)-(b.sort_order||0));
    const gE=gSteps.filter(s=>ecnChanges[s.id]).length;
    return(<div key={g.id} className="kan-col">
      <div className="kan-hdr" style={{background:g.color+'15',borderBottom:'2px solid '+g.color}}>
        <div style={{display:'flex',alignItems:'center',gap:6}}><span style={{fontSize:12}}>{g.icon}</span><span style={{fontSize:11,fontWeight:800,color:g.color,flex:1}}>{g.label}</span>{gE>0&&<span style={{fontSize:9,fontWeight:800,color:'var(--yellow)',background:'#451a03',padding:'1px 6px',borderRadius:3}}>{gE}</span>}</div>
        <div style={{fontSize:10,color:'var(--text4)',marginTop:2}}>{gSteps.length} steps</div>
      </div>
      <div className="kan-cards">{gSteps.map(s=>{
        const e=ecnChanges[s.id];const sel=selected===s.id;
        const pc=parts.filter(p=>p.step_id===s.id).length;const fc=fasts.filter(f=>f.step_id===s.id).length;
        const lts=[...new Set(fasts.filter(f=>f.step_id===s.id&&f.loctite&&f.loctite!=='---').map(f=>f.loctite))];
        return(<div key={s.id} className={'kan-card'+(sel?' selected':'')} onClick={()=>click(s.id)} style={{background:e?ecnBg[e]:undefined,borderColor:e?ecnC[e]:sel?'var(--blue)':undefined}}>
          {e&&<div style={{position:'absolute',top:4,right:6,fontSize:12,fontWeight:900,color:ecnC[e]}}>{ecnI[e]}</div>}
          <div style={{fontSize:11,color:s.type==='kanryo'?'var(--yellow)':'var(--text)',fontWeight:s.type==='kanryo'?800:400,paddingRight:e?16:0,marginBottom:4}}>{s.label}</div>
          <div style={{display:'flex',gap:4,flexWrap:'wrap'}}>{pc>0&&<span className="tag tag-p">{pc}P</span>}{fc>0&&<span className="tag tag-f">{fc}F</span>}{lts.map((l,i)=><span key={i} style={{fontSize:8,color:'var(--yellow)'}}>LT-{l}</span>)}</div>
        </div>);
      })}</div>
    </div>);
  })}</div>);
}

// ‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê
function AppInner(){
  const {assy,loading,error,toast,steps}=useData();
  const [view,setView]=useState('list');const [selected,setSelected]=useState(null);
  const [ecnOn,setEcnOn]=useState(false);const [brush,setBrush]=useState('remove');
  const [ecnChanges,setEcnChanges]=useState({});const [search,setSearch]=useState('');

  const ecnCount=Object.keys(ecnChanges).length;

  if(loading)return <div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',flexDirection:'column',gap:12}}>
    <div style={{width:200}}><div className="loading-bar" style={{overflow:'hidden',borderRadius:2}}></div></div>
    <div style={{color:'var(--text3)',fontSize:12}}>Connecting to Eagle_eye_...</div>
  </div>;

  if(error)return <div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',flexDirection:'column',gap:12,padding:40,textAlign:'center'}}>
    <div style={{fontSize:48,opacity:0.3}}>‚ö†Ô∏è</div>
    <div style={{color:'var(--red)',fontSize:14,fontWeight:700}}>Connection Error</div>
    <div style={{color:'var(--text3)',fontSize:12,maxWidth:400}}>{error}</div>
  </div>;

  return(<>
    <div className="app">
      <div className="sidebar" style={{width:view==='list'?420:320}}>
        <div className="hdr">
          <div className="status" style={{background:'var(--green)'}}/>
          <h1><span>Eagle Eye</span></h1>
          <span className="tag-badge">{assy?.tag}</span>
          <span className="count">{steps.length} steps</span>
        </div>
        <div className="tabs">{[{v:'list',l:'üìã List'},{v:'graph',l:'üîó Graph'},{v:'kanban',l:'üìä Kanban'}].map(t=><button key={t.v} className={'tab'+(view===t.v?' active':'')} onClick={()=>setView(t.v)}>{t.l}</button>)}</div>
        <div className="search-box"><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search P/N, step..."/></div>
        <div className="ecn-bar">
          <button className="ecn-btn" onClick={()=>setEcnOn(!ecnOn)} style={{border:ecnOn?'1px solid var(--yellow)':'1px solid var(--text4)',background:ecnOn?'#451a03':'transparent',color:ecnOn?'var(--yellow)':'var(--text4)'}}>{ecnOn?'‚ö° ECN':'ECN'}</button>
          {ecnOn&&[{s:'remove',l:'Remove',c:'var(--red)'},{s:'replace',l:'Replace',c:'var(--yellow)'},{s:'add',l:'Add',c:'var(--green)'},{s:'modify',l:'Modify',c:'var(--blue)'}].map(b=><button key={b.s} className="ecn-brush" onClick={()=>setBrush(b.s)} style={{border:'1px solid '+(brush===b.s?b.c:'var(--border)'),background:brush===b.s?b.c+'18':'transparent',color:brush===b.s?b.c:'var(--text4)'}}>{b.l}</button>)}
          {ecnCount>0&&<button className="ecn-brush" onClick={()=>setEcnChanges({})} style={{border:'1px solid var(--border)',background:'transparent',color:'var(--text4)',marginLeft:'auto'}}>Clear</button>}
        </div>
        {ecnCount>0&&<div className="ecn-summary">‚ö° {ecnCount} steps affected</div>}
        {view==='list'?<ListView selected={selected} setSelected={setSelected} ecnOn={ecnOn} brush={brush} ecnChanges={ecnChanges} setEcnChanges={setEcnChanges} search={search}/>:<DetailPanel stepId={selected} ecnChanges={ecnChanges}/>}
      </div>
      <div className="main">
        {view==='list'&&<DetailPanel stepId={selected} ecnChanges={ecnChanges}/>}
        {view==='graph'&&<GraphView selected={selected} setSelected={setSelected} ecnOn={ecnOn} brush={brush} ecnChanges={ecnChanges} setEcnChanges={setEcnChanges}/>}
        {view==='kanban'&&<KanbanView selected={selected} setSelected={setSelected} ecnOn={ecnOn} brush={brush} ecnChanges={ecnChanges} setEcnChanges={setEcnChanges}/>}
      </div>
    </div>
    {toast&&<div className="toast" style={{background:toast.type==='err'?'var(--red)':'var(--green)',color:'#fff'}}>{toast.msg}</div>}
  </>);
}

function App(){
  return <DataProvider><AppInner/></DataProvider>;
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
